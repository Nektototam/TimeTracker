# План модернизации и разделения на фронт/бек (Fastify + Prisma + Railway)

Цель: сохранить ключевой функционал (таймер, проекты, отчеты, Pomodoro, настройки, локализация) и заменить Supabase на собственный бекенд с БД в Railway.

## 0) Инвентаризация и аудит (обязательный старт)

- [ ] Подтвердить список функций: таймер, проекты, отчеты, Pomodoro, настройки, i18n, авторизация.
- [ ] Проверить актуальность UI-страниц и сопоставить с реальными данными.
- [ ] Снять технический долг: убрать заглушки в настройках, привести к реальным данным.

## 1) Архитектура и репозиторий

- [ ] Перевести проект в монорепо:
  - apps/web (Next.js)
  - apps/api (Fastify)
  - packages/shared (общие типы/DTO)
- [ ] Зафиксировать API-контракт (REST) между web и api.

## 2) База данных (Railway Postgres)

- [ ] Схема данных (минимум):
  - users
  - sessions (или refresh_tokens)
  - time_entries
  - user_settings
  - custom_project_types
- [ ] Миграции через Prisma Migrate.
- [ ] Индексы и ограничения целостности.

## 3) Аутентификация и безопасность

- [ ] Email + пароль (bcrypt) + сессии или JWT.
- [ ] Защита эндпоинтов (middleware, rate-limit, CORS).
- [ ] Валидация входных данных (Zod или TypeBox).

## 4) API (Fastify)

- [ ] CRUD time_entries (создание, пауза, завершение, фильтры по датам).
- [ ] CRUD custom_project_types.
- [ ] Настройки пользователя (read/write + data_retention_period).
- [ ] Отчеты (агрегации по периодам на сервере).

## 5) Frontend (Next.js)

- [ ] Заменить Supabase SDK на API-клиент.
- [ ] Реальные загрузка/сохранение настроек.
- [ ] Привести отчеты к данным API (без логики агрегаций в клиенте).
- [ ] Обновить состояние авторизации (context -> api session).

## 6) Фоновая очистка данных

- [ ] Запланированная задача Railway Cron для очистки старых записей.

## 7) Качество и поддержка

- [ ] Проверка доступности, базовая оптимизация и тесты.
- [ ] Документация по деплою на Railway.

## Выходные артефакты

- Технический отчет по текущему состоянию.
- План релиза v1 (миграция функционала) и v1.1 (качество/UX).
